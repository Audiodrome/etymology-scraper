<!DOCTYPE html>
<html>
<head>

<script src="https://d3js.org/d3.v4.min.js"></script>

<!-- Example data & options -->
<script src="data.js" ></script>
<script src="options.barchart.js"></script>

</head>

<body>

<svg width="960" height="500" id="barchart"></svg>

<script>

/*
 * Purpose: Show a barchart in ELEMENT using DATA and OPTIONS
 *
 * Attribution: Largely based on example at https://bl.ocks.org/mbostock/3885304
 */
function showBarchart(element, data, options) {
	var svg = element,
		margin = {top: 30, right: 20, bottom: 100, left: 50},
		width = +svg.attr("width") - margin.left - margin.right,
		height = +svg.attr("height") - margin.top - margin.bottom;

	var x = d3.scaleBand().rangeRound([0, width]).padding(0.1),
		y = d3.scaleLinear().rangeRound([height, 0]);

	var g = svg.append("g")
		.attr("transform", "translate(" + margin.left + "," + margin.top + ")");

	x.domain(data.map(function(d) { return d[options.xProperty]; }));
	y.domain([0, d3.max(data, function(d) { return d[options.yProperty]; })]);

	// X-Axis
	g.append("g")
	  .attr("class", "axis axis--x")
	  .attr("transform", "translate(0," + height + ")")
	  .call(d3.axisBottom(x))
      .selectAll("text")	
        .style("text-anchor", "end")
        .attr("dx", "-.8em")
        .attr("dy", ".15em")
        .attr("transform", "rotate(-65)");

	// Y-Axis
	g.append("g")
	  .attr("class", "axis axis--y")
	  .call(d3.axisLeft(y).ticks(10, "%"))
	.append("text")
	  .attr("transform", "rotate(-90)")
	  .attr("y", 6)
	  .attr("dy", "0.71em")
	  .style("text-anchor", "end")
	  .text("Frequency");
	
	// Bars
	g.selectAll(".bar")
	.data(data)
	.enter().append("rect")
	  .attr("class", "bar")
	  .attr("x", function(d) { return x(d[options.xProperty]); })
	  .attr("y", function(d) { return y(d[options.yProperty]); })
	  .attr("width", x.bandwidth())
	  .attr("height", function(d) { return height - y(d[options.yProperty]); })
	  .attr("fill", function(d){ return options.colorMap[d[options.colorProperty]]; })
	  .on("mouseover", function(d) {
			d3.select(this).style("fill", options.colorHover);
	  })                  
	  .on("mouseout", function(d) {
		d3.select(this).style("fill", function(d) {return options.colorMap[d[options.colorProperty]];});
	  });
}

// Purpose: Format data for barchart while leaving original JSON intact
function formatter(d) {
	d.percent = d.word.percent / 100;
	d.term = d.word.normal;
	return d;
}

deepCopy = JSON.parse(JSON.stringify(etymologies));

// Example Function Call
showBarchart(d3.select("#barchart"), deepCopy.map(formatter), options);

</script> 

</body>
</html>